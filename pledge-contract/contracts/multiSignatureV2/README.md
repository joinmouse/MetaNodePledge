
# MultiSignatureV2è§£æ

## ğŸ“¦ MultiSigWallet æ¶æ„

```
ğŸ“„ MultiSigWallet.sol
â”‚
â”œâ”€ ğŸ“š AddressArrayLib (å·¥å…·åº“)
â”‚  â”œâ”€ â• addAddress()       â†’ æ·»åŠ åœ°å€ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
â”‚  â”œâ”€ â– removeAddress()    â†’ ç§»é™¤æŒ‡å®šåœ°å€
â”‚  â””â”€ ğŸ” contains()         â†’ æ£€æŸ¥åœ°å€æ˜¯å¦å­˜åœ¨
â”‚
â””â”€ ğŸ¦ MultiSigWallet (å¤šç­¾é’±åŒ…åˆçº¦)
   â”‚
   â”œâ”€ ğŸ’¾ çŠ¶æ€å˜é‡
   â”‚  â”œâ”€ ğŸ‘¥ signatureOwners   â†’ å¤šç­¾æ‰€æœ‰è€…åˆ—è¡¨
   â”‚  â”œâ”€ ğŸ¯ threshold         â†’ ç­¾åé˜ˆå€¼ï¼ˆéœ€è¦å‡ ä¸ªç­¾åï¼‰
   â”‚  â””â”€ ğŸ“‹ signatureMap      â†’ ç”³è¯·è®°å½•æ˜ å°„è¡¨
   â”‚
   â”œâ”€ ğŸ‘‘ Owner ç®¡ç†
   â”‚  â””â”€ ğŸ”„ transferOwner()   â†’ è½¬ç§»owneræƒé™ï¼ˆéœ€å¤šç­¾ï¼‰
   â”‚
   â”œâ”€ âœï¸  å¤šç­¾æµç¨‹
   â”‚  â”œâ”€ ğŸ“ createApplication()      â†’ åˆ›å»ºå¤šç­¾ç”³è¯·
   â”‚  â”œâ”€ âœ… signApplication()        â†’ ç­¾åç¡®è®¤ç”³è¯·
   â”‚  â””â”€ âŒ revokeSignApplication()  â†’ æ’¤é”€å·²ç­¾å
   â”‚
   â””â”€ ğŸ” æŸ¥è¯¢å‡½æ•°
      â”œâ”€ âœ”ï¸  getValidSignature()     â†’ è·å–æœ‰æ•ˆç­¾åç´¢å¼•
      â”œâ”€ ğŸ“„ getApplicationInfo()     â†’ æŸ¥è¯¢ç”³è¯·è¯¦ç»†ä¿¡æ¯
      â”œâ”€ ğŸ”¢ getApplicationCount()    â†’ è·å–ç”³è¯·æ€»æ•°
      â””â”€ #ï¸âƒ£  getApplicationHash()    â†’ è®¡ç®—ç”³è¯·å“ˆå¸Œå€¼
```

### ğŸ”‘ æ ¸å¿ƒç‰¹æ€§

- **ğŸ›¡ï¸ å®‰å…¨æ€§**ï¼šå¤šäººç¡®è®¤æœºåˆ¶ï¼Œé˜²æ­¢å•ç‚¹é£é™©
- **âš¡ é«˜æ•ˆæ€§**ï¼šä½¿ç”¨ hash ç´¢å¼•ï¼ŒèŠ‚çœ gas æ¶ˆè€—
- **ğŸ”Œ å¯æ‰©å±•**ï¼šå…¶ä»–åˆçº¦å¯ç»§æ‰¿ MultiSigClient ä½¿ç”¨å¤šç­¾åŠŸèƒ½
- **ğŸ“Š é€æ˜æ€§**ï¼šæ‰€æœ‰ç”³è¯·å’Œç­¾åè®°å½•é“¾ä¸Šå¯æŸ¥

---

## ğŸ”Œ MultiSigClient æ¶æ„

```
ğŸ“„ MultiSigClient.sol
â”‚
â”œâ”€ ğŸ”— IMultiSignature (æ¥å£)
â”‚  â””â”€ âœ”ï¸  getValidSignature()  â†’ æŸ¥è¯¢ç­¾åæ˜¯å¦æœ‰æ•ˆ
â”‚
â””â”€ ğŸ›¡ï¸  MultiSigClient (å®¢æˆ·ç«¯åŸºç±»)
   â”‚
   â”œâ”€ ğŸ’¾ å­˜å‚¨è®¾è®¡
   â”‚  â”œâ”€ ğŸ“ MULTI_SIG_POSITION  â†’ å¤šç­¾é’±åŒ…åœ°å€å­˜å‚¨æ§½ä½
   â”‚  â””â”€ ğŸ”¢ DEFAULT_INDEX       â†’ é»˜è®¤ç´¢å¼•å€¼ï¼ˆ0ï¼‰
   â”‚
   â”œâ”€ ğŸ—ï¸  æ„é€ å‡½æ•°
   â”‚  â””â”€ constructor(address)   â†’ åˆå§‹åŒ–å¤šç­¾é’±åŒ…åœ°å€
   â”‚
   â”œâ”€ ğŸ” æ ¸å¿ƒä¿®é¥°å™¨
   â”‚  â””â”€ validCall()            â†’ è‡ªåŠ¨éªŒè¯å¤šç­¾ï¼ˆä¿æŠ¤å…³é”®å‡½æ•°ï¼‰
   â”‚
   â”œâ”€ ğŸ” å†…éƒ¨éªŒè¯
   â”‚  â””â”€ checkMultiSignature()  â†’ æ£€æŸ¥äº¤æ˜“æ˜¯å¦å·²è·æ‰¹å‡†
   â”‚
   â”œâ”€ ğŸ” æŸ¥è¯¢å‡½æ•°
   â”‚  â””â”€ getMultiSignatureAddress() â†’ è·å–å¤šç­¾é’±åŒ…åœ°å€
   â”‚
   â””â”€ ğŸ’¾ å­˜å‚¨å·¥å…·
      â”œâ”€ saveValue()            â†’ ä¿å­˜å€¼åˆ°æŒ‡å®šæ§½ä½
      â””â”€ getValue()             â†’ ä»æŒ‡å®šæ§½ä½è¯»å–å€¼
```

### ğŸ¯ ä½¿ç”¨æ–¹å¼

```solidity
// 1ï¸âƒ£ ç»§æ‰¿ MultiSigClient
contract PledgePool is MultiSigClient {
    constructor(address wallet) MultiSigClient(wallet) {}
    
    // 2ï¸âƒ£ ä½¿ç”¨ validCall ä¿æŠ¤å…³é”®å‡½æ•°
    function setInterestRate(uint256 rate) external validCall {
        // âœ… æ­¤å‡½æ•°è‡ªåŠ¨å—å¤šç­¾ä¿æŠ¤
        interestRate = rate;
    }
}

// 3ï¸âƒ£ è°ƒç”¨æµç¨‹
// Step 1: åœ¨å¤šç­¾é’±åŒ…åˆ›å»ºç”³è¯·å¹¶æ”¶é›†ç­¾å
bytes32 hash = wallet.getApplicationHash(alice, address(pool));
wallet.createApplication(address(pool));
wallet.signApplication(hash);  // Alice ç­¾å
wallet.signApplication(hash);  // Bob ç­¾å

// Step 2: ç›´æ¥è°ƒç”¨å—ä¿æŠ¤å‡½æ•°ï¼ˆè‡ªåŠ¨éªŒè¯ï¼‰
pool.setInterestRate(5);  // âœ… è‡ªåŠ¨æ£€æŸ¥å¤šç­¾ï¼Œé€šè¿‡åæ‰§è¡Œ
```

### ğŸ”‘ æ ¸å¿ƒç‰¹æ€§

- **ğŸ¯ ç®€å•æ˜“ç”¨**ï¼šä¸€ä¸ªä¿®é¥°å™¨æå®šå¤šç­¾ä¿æŠ¤
- **ğŸ”’ è‡ªåŠ¨éªŒè¯**ï¼šæ— éœ€æ‰‹åŠ¨æ£€æŸ¥ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†
- **ğŸ’¾ å®‰å…¨å­˜å‚¨**ï¼šä½¿ç”¨ EIP-1967 æ§½ä½æ¨¡å¼ï¼Œé¿å…å­˜å‚¨å†²çª
- **ğŸ”Œ çµæ´»æ‰©å±•**ï¼šä»»ä½•åˆçº¦éƒ½å¯ç»§æ‰¿ä½¿ç”¨

---


## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¦ MultiSigWallet                        â”‚
â”‚  (éªŒè¯ä¸­å¿ƒ - ç®¡ç†ç­¾åå’ŒéªŒè¯)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 1ï¸âƒ£ æ„é€ æ—¶ä¼ å…¥é’±åŒ…åœ°å€
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ›¡ï¸  MultiSigClient                       â”‚
â”‚  (åŸºç±» - æä¾› validCall ä¿®é¥°å™¨)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 2ï¸âƒ£ ä¸šåŠ¡åˆçº¦ç»§æ‰¿
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ’¼ YourContract                          â”‚
â”‚  (ä¸šåŠ¡åˆçº¦ - ä½¿ç”¨ validCall ä¿æŠ¤å…³é”®å‡½æ•°)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“ æ‰§è¡Œæµç¨‹ï¼š
1. ç”¨æˆ·åœ¨ MultiSigWallet åˆ›å»ºç”³è¯·
2. å¤šä¸ª owner ç­¾åç¡®è®¤
3. ç”¨æˆ·è°ƒç”¨ YourContract çš„å—ä¿æŠ¤å‡½æ•°
4. validCall è‡ªåŠ¨è°ƒç”¨ checkMultiSignature()
5. checkMultiSignature() æŸ¥è¯¢ MultiSigWallet
6. éªŒè¯é€šè¿‡ âœ… â†’ æ‰§è¡Œå‡½æ•°
7. éªŒè¯å¤±è´¥ âŒ â†’ äº¤æ˜“å›æ»š
```
